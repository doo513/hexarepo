<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CTF 자동화 테스트</title>
</head>
<body>
    <h1>CTF 문제 자동화 테스트</h1>

    <button onclick="startChallenge()">1번 문제 생성</button>
    <button onclick="stopChallenge()">1번 문제 종료</button>

    <p>
        접속 링크:
        <a id="challenge_link" href="#" target="_blank"></a>
    </p>

    <script>
let currentInstanceId = null;
const problemKey = "pwn1";   // 🔴 서버의 problem 파라미터와 맞춰야 함

function startChallenge() {
    fetch(`/start?problem=${problemKey}`, {
        method: "POST"
    })
    .then(res => {
        if (!res.ok) {
            throw new Error("HTTP error " + res.status);
        }
        return res.json();
    })
    .then(data => {
        console.log("start response:", data);

        if (data.status !== "ok") {
            alert("실행 실패: " + data.error);
            return;
        }

        currentInstanceId = data.instance_id;

        const link = document.getElementById("challenge_link");
        link.innerText = data.url;
        link.href = data.url;
    })
    .catch(err => {
        console.error("start error:", err);
        alert("start 요청 실패 (콘솔 확인)");
    });
}

function stopChallenge() {
    if (currentInstanceId === null) {
        alert("종료할 인스턴스가 없습니다.");
        return;
    }

    fetch(`/stop/${currentInstanceId}`, {
        method: "POST"
    })
    .then(res => {
        if (!res.ok) {
            throw new Error("HTTP error " + res.status);
        }
        return res.json();
    })
    .then(data => {
        console.log("stop response:", data);

        if (data.status !== "ok") {
            alert("종료 실패: " + data.error);
            return;
        }

        alert("문제 종료 완료");

        currentInstanceId = null;
        const link = document.getElementById("challenge_link");
        link.innerText = "";
        link.href = "#";
    })
    .catch(err => {
        console.error("stop error:", err);
        alert("stop 요청 실패 (콘솔 확인)");
    });
}
</script>


</body>
</html>
